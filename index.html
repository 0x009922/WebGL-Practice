<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>index</title>
		<style>
			@font-face {
				font-family: "Monofur";
				src: url("Fonts/Monofur.ttf");
			}
			body { margin: 0; background: black; }
			.tile {
				border: 2px solid white;
				background: transparent;
				width: 300px;
				height: 200px;
				transition: background 0.3s ease-in-out,
										opacity 0.3s ease-in-out,
										color 0.3s ease-in-out;
				cursor: default;
				color: white;
			}
			.tile .label {
				font-size: 40px;
				margin: 20px;
				font-family: Monofur, Menlo, Consolas, monospace;
			}
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script src="js/tween.min.js"></script>
		<script src="js/CSS3DRenderer.js"></script>
		<script>
			const _tileWidth = 300;
			const _tileHeight = 200;
			const _tileMove = 100;
			const _tileMoveDuration = 200;
			const _tileInactiveOpacity = 0.7;
			const _cameraMove = 100;
			const _cameraPositionZ = 1000;

			const _columns = 4;
			const _rows = 3;
			const _gap = 50;

			const data = [
				{
					label: "First",
					link: "html/First.html"
				},
				{
					label: "Hexagon experiment",
					link: "html/First.html"
				},
				{
					label: "Space",
					link: "html/Space.html"
				},
				{
					label: "Triangles & Floor",
					link: "html/Triangles&Floor.html"
				},
				{
					label: "Sticks scene",
					link: "html/SticksScene.html"
				},
				{
					label: "Sticks hole",
					link: "html/SticksHole.html"
				},
				{
					label: "Red room",
					link: "html/RedRoom.html",
					accent: "#a00000"
				},
				{
					label: "Interactive experiment",
					link: "html/InteractiveExperiment.html"
				},
				{
					label: "InterActive II",
					link: "html/InterActiveII.html"
				}
			];

			class Tile {
				constructor(position, accent, data) {
					if (data.accent) accent = data.accent;

					let tile = document.createElement("div");
					tile.className = "tile";
					tile.style.background = "transparent";
					tile.style.borderColor = accent;
					tile.onclick = () => {window.location = data.link};
					let label = document.createElement("div");
					label.className = "label";
					label.textContent = data.label;
					tile.appendChild(label);
					tile.onmouseover = this._mouseOver.bind(this);
					tile.onmouseout = this._mouseOut.bind(this);

					this.object = new THREE.CSS3DObject(tile);
					this.object.position.set(
						position.x,
						position.y,
						position.z
					);
					scene.add(this.object);

					this.element = tile;
					this.positionTween = null;
					this.position = position;
					this.accent = accent;
					this.active = false;
				}

				_mouseOver() {
					this.active = true;
				}

				_mouseOut() {
					this.active = false;
				}

				get active() {
					return this._act;
				}

				set active(v) {
					if (v != this._act) {
						if (v) {

							this.element.style.background = this.accent;
							this.element.style.opacity = 1;
							this.element.style.color = "black";

							if (this.positionTween) {
								this.positionTween.stop();
							}
							this.positionTween = new TWEEN.Tween(this.object.position)
								.to({z: this.position.z + _tileMove}, _tileMoveDuration)
								.easing(TWEEN.Easing.Quadratic.InOut)
								.start();

						} else {

							this.element.style.background = "transparent";
							this.element.style.opacity = _tileInactiveOpacity;
							this.element.style.color = "white";

							if (this.positionTween) {
								this.positionTween.stop();
							}
							this.positionTween = new TWEEN.Tween(this.object.position)
								.to({z: this.position.z}, _tileMoveDuration)
								.easing(TWEEN.Easing.Quadratic.InOut)
								.start();

						}
					}
					this._act = v;
				}
			}

			function init() {
				scene = new THREE.Scene();
	      camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 0.1, 1000 );
	      renderer = new THREE.CSS3DRenderer({

				});
	      renderer.setSize( window.innerWidth, window.innerHeight );
	      document.body.appendChild( renderer.domElement );
				document.body.onmousemove = onMouseMove;

				camera.position.set(0, 0, _cameraPositionZ);

				clock = new THREE.Clock();

				tiles = [];
				for (let i = 0; i < data.length; i++) {
					tiles.push(new Tile(
						gridPosition(i),
						"hsl(" + Math.floor(Math.random() * 360) + ", 100%, 50%)",
						data[i]
					));
				}
			}

      function animate() {
      	requestAnimationFrame( animate );

				TWEEN.update();

      	renderer.render( scene, camera );
      }

			function onMouseMove(event) {
				let halfWidth = window.innerWidth / 2;
				let halfHeight = window.innerHeight / 2;

				let vector = new THREE.Vector2(
					(event.pageX - halfWidth) / halfWidth,
					-(event.pageY - halfHeight) / halfHeight
				)

				/*camera.position.set(
					vector.x * _cameraMove,
					vector.y * _cameraMove,
					_cameraPositionZ
				);*/
				camera.lookAt(
					vector.x * _cameraMove,
					vector.y * _cameraMove,
					0
				);
			}

			function gridPosition(index) {
				let c = index % _columns, r = Math.floor(index / _columns);
				return new THREE.Vector3(
					c * (_tileWidth + _gap) - ((_columns - 1) * _tileWidth / 2 + (_columns - 2) * _gap),
					-(r * (_tileHeight + _gap) - ((_rows - 1) * _tileHeight / 2 + (_rows - 2) * _gap)),
					0
				);
			}

			function between(pair, n) {
        return n * (pair[1] - pair[0]) + pair[0];
      }

			function fromHex(hex) {
				return [
					hex >> 16,
					(hex & 0x00ff00) >> 8,
					hex & 0xff
				];
			}

			function toHex(r, g, b) {
				return Math.floor(r) << 16 + Math.floor(g) << 8 + Math.floor(b);
			}

			let scene, renderer, camera, clock;
			let tiles, grid;

			init();
			animate();


		</script>
	</body>
</html>
