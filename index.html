<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Navigation</title>
		<style>
			* {
				box-sizing: border-box;
				user-select: none;
				cursor: default;
			}
			@font-face {
				font-family: "Monofur";
				src: url("fonts/Monofur.ttf");
			}
			body {
				margin: 0;
				background: black;
				font-family: Monofur, Menlo, Consolas, monospace;
			}
			.tile {
				border: 2px solid white;
				background: transparent;
				transition: background 0.3s ease-in-out,
										opacity 0.3s ease-in-out,
										color 0.3s ease-in-out;
				cursor: pointer;
				color: white;
			}
			.tile::selection {
				color: transparent;
			}
			.tile .label {
				font-size: 40px;
				margin: 20px;
				cursor: inherit;
			}

			.header-label {
				font-size: 150px;
				color: white;
			}
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script src="js/tween.min.js"></script>
		<script src="js/CSS3DRenderer.js"></script>
		<script>
			const _tileWidth = 300;
			const _tileHeight = 150;
			const _tileMove = 50;
			const _tileMoveDuration = 300;
			const _tileInactiveOpacity = 0.7;
			const _cameraMove = -200;
			const _lookAtMove = 00;
			const _cameraPositionZ = 1000;

			const _columns = 4;
			const _rows = 3;
			const _gap = 30;
			const _headerHeight = 170;
			const _gridWidth = _columns * _tileWidth + (_columns - 1) * _gap;
			const _gridHeight = _rows * _tileHeight + (_rows - 1) * _gap;

			const data = [
				{
					label: "First",
					link: "html/First.html"
				},
				{
					label: "Hexagon experiment",
					link: "html/HexagonExperiment.html"
				},
				{
					label: "Space",
					link: "html/Space.html"
				},
				{
					label: "Triangles & Floor",
					link: "html/Triangles&Floor.html"
				},
				{
					label: "Sticks scene",
					link: "html/SticksScene.html"
				},
				{
					label: "Sticks hole",
					link: "html/SticksHole.html"
				},
				{
					label: "Red room",
					link: "html/RedRoom.html",
					accent: "#a00000"
				},
				{
					label: "Cubes room [VR]",
					link: "html/CubesRoomVR.html"
				},
				{
					label: "Interactive experiment",
					link: "html/InteractiveExperiment.html"
				},
				{
					label: "InterActive II",
					link: "html/InterActiveII.html"
				}
			];

			class Tile {
				constructor(position, accent, data) {
					if (data.accent) accent = data.accent;

					let tile = document.createElement("div");
					tile.className = "tile";
					tile.style.background = "transparent";
					tile.style.borderColor = accent;
					tile.style.width = _tileWidth + "px";
					tile.style.height = _tileHeight + "px";

					let label = document.createElement("div");
					label.className = "label";
					label.textContent = data.label;
					tile.appendChild(label);

					tile.onmouseover = this._mouseOver.bind(this);
					tile.onmouseout = this._mouseOut.bind(this);
					tile.onmousedown = () => {
						window.location = data.link;
					};

					this.object = new THREE.CSS3DObject(tile);
					this.object.position.set(
						position.x,
						position.y,
						position.z
					);
					scene.add(this.object);

					this.element = tile;
					this.positionTween = null;
					this.position = position;
					this.accent = accent;
					this.active = false;
				}

				_mouseOver() {
					this.active = true;
				}

				_mouseOut() {
					this.active = false;
				}

				get active() {
					return this._act;
				}

				set active(v) {
					if (v != this._act) {
						if (v) {

							this.element.style.background = this.accent;
							this.element.style.opacity = 1;
							this.element.style.color = "black";

							this._setMoveTween(1, _tileMoveDuration);

						} else {

							this.element.style.background = "transparent";
							this.element.style.opacity = _tileInactiveOpacity;
							this.element.style.color = "white";

							this._setMoveTween(0, _tileMoveDuration);

						}
					}
					this._act = v;
				}

				_setMoveTween(state, duration) {
					if (this.positionTween) this.positionTween.stop();
					this.positionTween = new TWEEN.Tween(this.object.position)
						.to({z: this.position.z + _tileMove * state}, duration)
						.easing(TWEEN.Easing.Quadratic.InOut)
						.start();
				}
			}

			function init() {
				scene = new THREE.Scene();
				renderer = new THREE.CSS3DRenderer({
					antialias: true
				});
	      renderer.setSize( window.innerWidth, window.innerHeight );
	      document.body.appendChild( renderer.domElement );

	      camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 0.1, 1000 );
	      camera.position.set(0, 0, _cameraPositionZ);

				document.body.onmousemove = onMouseMove;

				tiles = [];
				for (let i = 0; i < data.length; i++) {
					tiles.push(new Tile(
						gridPosition(i),
						"hsl(" + Math.floor(Math.random() * 360) + ", 100%, 50%)",
						data[i]
					));
				}

				let header = document.createElement("div");
				header.className = "header-label";
				header.textContent = "Welcome! :)"
				header.style.width = _gridWidth + "px";
				header.style.height = _headerHeight + "px";
				let header3d = new THREE.CSS3DObject(header);
				header3d.position.set(0, (_gridHeight) / 2, 0);
				scene.add(header3d);
			}

      function animate() {
      	requestAnimationFrame( animate );

				TWEEN.update();

      	renderer.render( scene, camera );
      }

			function onMouseMove(event) {
				let wh = window.innerWidth / window.innerHeight;

				let vector = new THREE.Vector2(
					(event.pageX / window.innerWidth * 2 - 1) * wh,
					-(event.pageY / window.innerHeight * 2 - 1)
				);

				camera.position.set(
					vector.x * _cameraMove,
					vector.y * _cameraMove,
					_cameraPositionZ
				);
				camera.lookAt(
					vector.x * _lookAtMove,
					vector.y * _lookAtMove,
					0
				);
			}

			function gridPosition(index) {
				let c = index % _columns, r = Math.floor(index / _columns);
				return new THREE.Vector3(
					c * (_tileWidth + _gap) + _tileWidth / 2 - _gridWidth / 2,
					-(r * (_tileHeight + _gap) + _tileHeight / 2 - (_gridHeight - _headerHeight) / 2),
					0
				);
			}

			let scene, renderer, camera;
			let tiles, grid;

			init();
			animate();
		</script>
	</body>
</html>
